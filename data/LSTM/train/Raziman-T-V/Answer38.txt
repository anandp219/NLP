Let [math]j[/math] be one of such numbers  whose prime factors form the set [math]T \subset S[/math]. It is clear that the cost due to the current element is [math]|a_i - j|[/math]. Also  the minimum cost you can obtain from the previous elements is clearly [math]\rm{DP}(i-1 S \setminus T)[/math] since none of the factors of the current element can be used in previous elements. This gives a total of [math]|a_i - j| + \rm{DP}(i-1 S \setminus T)[/math]  and minimising it over all [math]j[/math] gives us [math]\rm{DP}(i S)[/math].The base case of the recurrence is clearly [math]\rm{DP}(0 S) = 0 \;\forall\; S[/math].