Both the getparent() and LCA() functions need to be run at most once per query and take [math]O(\log N)[/math] each. Thus the overall time complexity of the solution is [math]O((N+Q) \log N)[/math] and the space complexity is [math]O(N \log N)[/math]. There are algorithms which can find LCA in linear space and time with a different preprocessing  but they are conceptually harder and this one should be enough for most competitive programming applications. In any case  here is a link with an explanation of the [math]O(N)[/math] solution : Range Minimum Query and Lowest Common Ancestor