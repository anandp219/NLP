 If all the numbers were powers of a certain prime p, how would you solve the problem?Let the numbers be [math]p^{e_1}, p^{e_2} \ldots p^{e_N}[/math], with [math]e_1 \geq e_2 \geq e_3 \ldots e_N[/math]. The gcd of a subset is just the smallest power of [math]p[/math] in the subset. For making things simple, when there are multiple equal numbers, we will say that the highest index number is what is chosen as the gcd. That is, if [math]e_1=e_2[/math], we will say that [math]\gcd(p^{e_1},p^{e_2})[/math] is actually [math]p^{e_2}[/math].With this, let us see how many subsets [math]p^{e_i}[/math] is the gcd of. Clearly, [math]p^{e_1}[/math] is the gcd of only the set [math]\{p^{e_1}\}[/math]. [math]p^{e_2}[/math] is the gcd of only the sets [math]\{p^{e_2}\},\{p^{e_1},p^{e_2}\}[/math]. In general, [math]p^{e_i}[/math] is the gcd of [math]2^{i-1}[/math] subsets.Thus the product of gcds of all subsets is[math]\prod\limits_{i=1}^n (p^{e_i})^{2^{(i-1)}} = \prod\limits_{i=1}^n p^{e_i 2^{(i-1)}}[/math]The products have to be done modulo the prime [math]P=10^9+7[/math]. Also note that [math]a^b \equiv a^{b \bmod{(P-1)}} \bmod{P}[/math].In the more general case, the trick is to deal with primes individually.First, sieve up to the limit ([math]10^5[/math]) and find all primes in the range - there are less than 10000 of them - and the smallest prime factor for each number. This can be used to factorise the numbers efficiently. For the primes [math]p_i[/math] which are found, keep a list [math]e(p_i)[][/math] which stores the prime powers as above.For each [math]A_i[/math], find its prime factorisation [math]p_1^{q_1} p_2^{q_2} \ldots p_k^{q_k}[/math]. For each such [math]p_i[/math], add [math]q_i[/math] to the list [math]e(p_i)[/math]. After all the [math]N[/math] numbers have been processed, use the procedure above for each prime to find the gcd product. The product of the gcd products of all primes gives the required answer.ExampleSuppose the array is [math]1,2,3 \ldots10[/math]. The primes in the range are [math]2,3,5,7[/math]. After processing all the 10 numbers we find for each prime:2 : [math]e[2]=\{3,2,1,1,1\}[/math] : Subset gcd product = [math]2^{35}[/math]3 : [math]e[3] = \{2,1,1\}[/math] : Subset gcd product = [math]3^8[/math]5 : [math]e[5] = \{1,1\}[/math] : Subset gcd product = [math]5^3[/math]7 : [math]e[7] = \{1\} [/math] : Subset gcd product = [math]7^1[/math]The required answer is just [math]2^{35} 3^8 5^3 7^1 \equiv 622607273 \bmod (10^9+7)[/math]