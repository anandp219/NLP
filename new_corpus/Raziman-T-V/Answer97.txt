If matrix multiplication is performed in [math]O(L^3)[/math] where [math]L[/math] is the size of the matrix  the matrix power can be found in [math]O(L^3 \log x)[/math] using exponentiation by squaring. Thus after finding the values of [math]f(N K)[/math] for [math]N \leq K[/math] using the recurrence  matrix exponentiation can be used to find the solution in [math]O(K^6 \log N)[/math]  which should be efficient enough for the problem.